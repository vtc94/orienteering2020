{"version":3,"sources":["components/Alert.js","components/courses/playerView/CourseScan.js","css/courses/playerView/CourseScanStyle.js"],"names":["showAlert","ref","showTime","document","getElementById","removeAlert","window","sessionStorage","getItem","clearTimeout","remove","div","createElement","id","innerHTML","body","appendChild","setTimeout","setItem","CourseScan","props","state","handleResult","bind","countTimeLeft","cookieHelpers","CookieHelpers","course","this","setState","event","type","username","getCookie","checkPointId","firstCheckPoint","checkPointNo","qrCode","score","timeTaken","speed","scanNo","position","SubmitDataHelpers","postData","then","res","error","h","parseInt","m","s","self","scanner","Instascan","Scanner","video","scanPeriod","mirror","addListener","content","Camera","getCameras","cameras","length","start","alert","setInterval","CourseScanStyle","renderResult","clearInterval","className","calculateTimeTaken","startTime","split","date","Date","getHours","getMinutes","getSeconds","endTime","timeLeft","resultComponent","push","key","ReactDOM","render","React","Component","setStyle","eId","style","height","innerHeight","ScanStyle","darkLightMode","userAgent","navigator","vendor","opera","test","addEventListener"],"mappings":"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","file":"static/js/7.87ef6b52.chunk.js","sourcesContent":["let showAlert = function showAlert(ref, showTime){\n    if(document.getElementById('error')){\n        let removeAlert = window.sessionStorage.getItem(\"removeAlert\");\n        clearTimeout(removeAlert);\n        document.getElementById('error').remove();\n    }\n\n    let div = document.createElement('div');\n    div.id = 'error';\n    div.innerHTML = ''\n                + '<div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\" style=\"text-align:center\">'\n                +    ref\n                +    '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">'\n                +    '<span aria-hidden=\"true\">&times;</span>'\n                +    '</button>'\n                + '</div>';\n    document.body.appendChild(div);\n\n    if(showTime != -1){\n        let removeAlert = setTimeout(function(){\n            if(document.getElementById('error')){\n                document.getElementById('error').remove();\n            }\n        }, showTime);\n\n        window.sessionStorage.setItem(\"removeAlert\", removeAlert);\n    }\n}\n\nexport {showAlert};","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport Instascan from 'instascan-v2';\r\nimport {showAlert} from '../../Alert';\r\nimport SubmitDataHelpers from '../../helpers/SubmitDataHelpers';\r\nimport CookieHelpers from '../../helpers/CookieHelpers';\r\n\r\nimport CourseScanStyle from '../../../css/courses/playerView/CourseScanStyle';\r\nimport '../../../css/courses/playerView/CourseScan.css';\r\n\r\nclass CourseScan extends React.Component{\r\n    constructor(props){\r\n        super(props);\r\n        this.state = {};\r\n        this.handleResult = this.handleResult.bind(this);\r\n        this.countTimeLeft = this.countTimeLeft.bind(this);\r\n    }\r\n\r\n    componentDidMount(){\r\n        let cookieHelpers = new CookieHelpers;\r\n        let course = {...this.props.course};\r\n        \r\n        this.setState({\r\n            event: course.event,\r\n            course: course.type,\r\n            username: cookieHelpers.getCookie(\"username\"),\r\n            checkPointId: course.firstCheckPoint - 1,\r\n            checkPointNo: course.checkPointNo,\r\n            firstCheckPoint: course.firstCheckPoint,\r\n            qrCode: '',\r\n            score: 0,\r\n            timeTaken: 0,\r\n            speed: 0,\r\n            scanNo: 0,\r\n            position: 0,\r\n        });       \r\n        \r\n        let helpers = new SubmitDataHelpers;\r\n        helpers.postData('/results/lastScan/', \r\n        {\r\n            event: this.props.course.event,\r\n            type: this.props.course.type,\r\n            username: cookieHelpers.getCookie(\"username\"),\r\n        }).then((res) => {\r\n            //console.log(res); // JSON data parsed by `response.json()` call\r\n            if(res.error){\r\n                //console.log(res.error);\r\n                showAlert(res.error, 5000);\r\n            } else {\r\n                let h = parseInt(res.timeTaken/3600);\r\n                let m = parseInt((res.timeTaken - h*3600)/60);\r\n                let s = res.timeTaken - h * 3600 - m * 60;\r\n\r\n                h = h < 10? '0' + h : h;\r\n                h = h == 0? '' : h + ' h ';\r\n                m = m < 10? '0' + m + ' m ': m + ' m ';\r\n                s = s < 10? '0' + s + ' s': s + ' s';\r\n\r\n                this.setState({\r\n                    checkPointId: res.checkPointId,\r\n                    score: res.score,\r\n                    timeTaken: (h + m + s),\r\n                    scanNo: res.scanNo,\r\n                    position: res.position,\r\n                }); \r\n                //window.location.reload();\r\n                //console.log(this.state);\r\n            }\r\n        });\r\n        \r\n        var self =this;\r\n        if(document.getElementById('preview')){\r\n            let scanner = new Instascan.Scanner({ video: document.getElementById('preview'), scanPeriod: 5, mirror: false, });\r\n                scanner.addListener('scan', function (content) {\r\n                    self.setState({...self.state, ['qrCode']: content});\r\n                    self.handleResult();\r\n                });\r\n\r\n            Instascan.Camera.getCameras().then(function (cameras) {\r\n                if (cameras.length > 0) {\r\n                    scanner.start(cameras[0]);\r\n                } else {\r\n                    window.alert(\"No camera found\");\r\n                }\r\n            });\r\n        }\r\n\r\n        let countTimeLeft = window.setInterval(this.countTimeLeft,1000);\r\n        window.sessionStorage.setItem('countTimeLeft', countTimeLeft);\r\n\r\n        CourseScanStyle();\r\n    }\r\n\r\n    componentDidUpdate(){\r\n        if(document.getElementById('scanResults')){\r\n            this.renderResult();\r\n        }\r\n        \r\n        CourseScanStyle();\r\n    }\r\n\r\n    componentWillUnmount(){\r\n        clearInterval(window.sessionStorage.countTimeLeft);\r\n    }\r\n\r\n    render(){\r\n        return (\r\n            <div>\r\n                <video id=\"preview\"></video>\r\n                <div id=\"scanResults\" className=\"scanResults col-8 col-sm-6 mx-auto justify-content-center py-4 shadow\">\r\n                    <h4 className='col-12 mb-3'>Result</h4>\r\n                    <div className='col-10 d-flex flex-row justify-content-center mx-auto p-3 shadow'>\r\n                        <div className='px-1'>\r\n                            <div className='text-left'>Checkpoint No</div>\r\n                            <div className='text-left'>Number of Scans</div>\r\n                            <div className='text-left'>Time Taken</div>\r\n                            <div className='text-left'>{this.state.course == 'Score'? 'Score' : ''}</div>\r\n                            <div className='text-left'>Position</div>\r\n                            <div className='text-left'>Time Left</div>\r\n                        </div>\r\n                        <div id='result' className='result px-1'></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    handleResult(){\r\n        //console.log(this.state);\r\n\r\n        let helpers = new SubmitDataHelpers;\r\n        helpers.postData('/results/addResult/', \r\n        {\r\n            event: this.state.event,\r\n            type: this.state.course,\r\n            username: this.state.username,\r\n            checkPointNo: this.state.checkPointNo,\r\n            firstCheckPoint: this.state.firstCheckPoint,\r\n            checkPointId: this.state.checkPointId,\r\n            qrCode: this.state.qrCode,\r\n            score: this.state.score,\r\n            timeTaken: this.calculateTimeTaken(),\r\n            scanNo: this.state.scanNo,\r\n        }).then((res) => {\r\n            //console.log(res); // JSON data parsed by `response.json()` call\r\n            if(res.error){\r\n                //console.log(res.error);\r\n                showAlert(res.error, 5000);\r\n                //alert(res.error);\r\n                this.setState({error: res.error});\r\n                //console.log(this.state);\r\n            } else {\r\n                let h = parseInt(res.timeTaken/3600);\r\n                let m = parseInt((res.timeTaken - h*3600)/60);\r\n                let s = res.timeTaken - h * 3600 - m * 60;\r\n\r\n                h = h < 10? '0' + h : h;\r\n                h = h == 0? '' : h + ' h ';\r\n                m = m < 10? '0' + m + ' m ': m + ' m ';\r\n                s = s < 10? '0' + s + ' s': s + ' s';\r\n\r\n                this.setState({\r\n                    checkPointId: res.checkPointId,\r\n                    score: res.score,\r\n                    timeTaken: (h + m + s),\r\n                    scanNo: res.scanNo,\r\n                    position: res.position,\r\n                }); \r\n                //window.location.reload();\r\n                //console.log(this.state);\r\n            }\r\n        });\r\n    }\r\n\r\n    calculateTimeTaken(){\r\n        let startTime = this.props.course.startTime;\r\n        startTime = startTime.split(\":\");\r\n        startTime = startTime[0]*3600 + startTime[1]*60;\r\n        let date = new Date();\r\n        let currentTime =  date.getHours()*3600 + date.getMinutes()*60 + date.getSeconds();\r\n\r\n        return (currentTime - startTime); \r\n    }\r\n\r\n    countTimeLeft(){\r\n        let endTime = this.props.course.endTime;\r\n\r\n        endTime = endTime.split(\":\");\r\n        endTime = endTime[0]*3600 + endTime[1]*60;\r\n        \r\n        let date = new Date();\r\n        let currentTime =  date.getHours()*3600 + date.getMinutes()*60 + date.getSeconds();\r\n    \r\n        let timeLeft = endTime - currentTime;\r\n\r\n        let h = parseInt(timeLeft/3600);\r\n        let m = parseInt((timeLeft - h*3600)/60);\r\n        let s = timeLeft - h * 3600 - m * 60;\r\n\r\n        h = h < 10? '0' + h : h;\r\n        h = h == 0? '' : h + ' : ';\r\n        m = m < 10? '0' + m + ' : ': m + ' : ';\r\n        s = s < 10? '0' + s : s;\r\n        \r\n        timeLeft = h + m + s;\r\n\r\n        this.setState({timeLeft: timeLeft});\r\n    }\r\n\r\n    renderResult(){\r\n        let resultComponent = [];\r\n\r\n        if(this.state.scanNo && this.state.scanNo > 0){\r\n            resultComponent.push(\r\n                <div key='result'>\r\n                    <div className='text-left'>: {this.state.checkPointId - this.state.firstCheckPoint + 1}</div>\r\n                    <div className='text-left'>: {this.state.scanNo}</div>\r\n                    <div className='text-left'>: {this.state.timeTaken}</div>\r\n                    <div className='text-left'>{this.state.course == 'Score'? (': ' + this.state.score) : ''}</div>\r\n                    <div className='text-left'>: {this.state.position}</div>\r\n                    <div className='text-left'>: {this.state.timeLeft}</div>\r\n                </div>\r\n            );\r\n        } else {\r\n            resultComponent.push(\r\n                <div key='result'>\r\n                    <div>: --</div>\r\n                    <div>: --</div>\r\n                    <div>: --</div>\r\n                    <div>{this.state.course == 'Score'? ': --' : ''}</div>\r\n                    <div>: --</div>\r\n                    <div>: --</div>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        ReactDOM.render(resultComponent, document.getElementById('result'));\r\n    }\r\n}\r\n\r\nexport default CourseScan;","import {eId, eClass, darkLightMode} from '../../../components/helpers/StylingHelpers';\n\nfunction ScanStyle(){\n    setDarkLightMode();\n    setStyle();\n\n    var userAgent = navigator.userAgent || navigator.vendor || window.opera;\n    if (!(/android/i.test(userAgent))) {\n        window.addEventListener('resize', setStyle);\n    }\n}\n\nexport default ScanStyle;\n\nfunction setDarkLightMode(){\n    darkLightMode(\"scanResults\");\n}\n\nfunction setStyle(){\n    eId('preview').style.height = window.innerHeight + 'px';\n}"],"sourceRoot":""}